# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –ø—Ä–æ—à–∏–≤–∫–∏ FPGA TimeCard_Production

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ —á–µ—Ä–µ–∑ JTAG](#–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è-–ø—Ä–æ—à–∏–≤–∫–∞-—á–µ—Ä–µ–∑-jtag)
3. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É (Linux)](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–ø—Ä–æ—à–∏–≤–∫–∏-—á–µ—Ä–µ–∑-—Å–∏—Å—Ç–µ–º—É-linux)
4. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø–æ—Å–ª–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
5. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
6. [–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#–≤–∞–∂–Ω—ã–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä

–ü—Ä–æ—à–∏–≤–∫–∞ FPGA TimeCard_Production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **Multiboot** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

- **Golden Image** (Fallback): –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É `0x00000000` –≤ SPI Flash
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ SPI Flash
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ø—Ä–∏ —Å–±–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  
- **Update Image** (–û–±–Ω–æ–≤–ª—è–µ–º—ã–π): –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É `0x00400000` –≤ SPI Flash
  - –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å TimeCard
  - –≠—Ç–æ —Ç–æ—Ç –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ FPGA —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å Update Image. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Golden Image.

---

## –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ —á–µ—Ä–µ–∑ JTAG

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–ª–∏ –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.**

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Vivado 2019.1 –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è
- USB JTAG –∫–∞–±–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Digilent USB-JTAG)
- –§–∞–π–ª `Factory_TimeCardOS_Production.bin` (—Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–∞ –æ–±—Ä–∞–∑–∞: Golden –∏ Update)

### –®–∞–≥–∏

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ JTAG –∫–∞–±–µ–ª—å** –∫ –ø–ª–∞—Ç–µ TimeCard

2. **–û—Ç–∫—Ä–æ–π—Ç–µ Vivado Hardware Manager**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ Vivado
   - –û—Ç–∫—Ä–æ–π—Ç–µ Hardware Manager (Tools ‚Üí Hardware Manager)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
   - –ù–∞–∂–º–∏—Ç–µ "Open target" ‚Üí "Auto Connect"
   - –î–æ–ª–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `xc7a100t_0`

4. **–î–æ–±–∞–≤—å—Ç–µ SPI Flash –≤ –ø—Ä–æ–µ–∫—Ç** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞)
   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ `xc7a100t_0`
   - –í—ã–±–µ—Ä–∏—Ç–µ "Add Configuration Memory Device..."
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: `mt25ql128-spi-x1_x2_x4`
   - –ù–∞–∂–º–∏—Ç–µ OK

5. **–ü—Ä–æ—à–µ–π—Ç–µ Factory –æ–±—Ä–∞–∑**
   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ `mt25ql128-spi-x1_x2_x4`
   - –í—ã–±–µ—Ä–∏—Ç–µ "Program Configuration Memory Device..."
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª: `Factory_TimeCardOS_Production.bin`
   - **–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–Ω–æ `Factory_...bin`, –∞ –Ω–µ `TimeCardOS_Production.bin`!
   - –ù–∞–∂–º–∏—Ç–µ OK –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

6. **–û—Ç–∫–ª—é—á–∏—Ç–µ JTAG** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ **—Ö–æ–ª–æ–¥–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É** (–ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è)

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É (Linux)

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º–µ.**

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ devlink (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –¥—Ä–∞–π–≤–µ—Ä `ptp_ocp` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç devlink –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```bash
# 1. –ù–∞–π–¥–∏—Ç–µ PCIe –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
lspci | grep -i "time\|facebook\|celestica"
# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞: 02:00.0 Unassigned class [ff00]: Facebook Device 0400

# 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (–æ–±—ã—á–Ω–æ 0000:02:00.0)
PCI_ADDR=$(lspci -D | grep -i "time\|facebook\|celestica" | cut -d' ' -f1)
echo "PCI –∞–¥—Ä–µ—Å: $PCI_ADDR"

# 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏
sudo cp TimeCardOS_Production.bin /lib/firmware/

# 4. –ü—Ä–æ—à–µ–π—Ç–µ —á–µ—Ä–µ–∑ devlink
sudo devlink dev flash pci/$PCI_ADDR file /lib/firmware/TimeCardOS_Production.bin

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
echo $?
# 0 = —É—Å–ø–µ—à–Ω–æ, –Ω–µ 0 = –æ—à–∏–±–∫–∞
```

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `TimeCardOS_Production.bin` (Update –æ–±—Ä–∞–∑), –∞ –ù–ï `Factory_TimeCardOS_Production.bin`!

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ AXI Quad SPI (–µ—Å–ª–∏ devlink –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

–ï—Å–ª–∏ devlink –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ AXI Quad SPI:

```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø—Ä–æ—à–∏–≤–∫–∏ —á–µ—Ä–µ–∑ AXI Quad SPI

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
SPI_BASE=0x00310000      # –ê–¥—Ä–µ—Å AXI Quad SPI –≤ –∞–¥—Ä–µ—Å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
UPDATE_ADDR=0x00400000   # –ê–¥—Ä–µ—Å –≤ SPI Flash –¥–ª—è Update –æ–±—Ä–∞–∑–∞
BIN_FILE="TimeCardOS_Production.bin"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞
if [ ! -f "$BIN_FILE" ]; then
    echo "–û—à–∏–±–∫–∞: —Ñ–∞–π–ª $BIN_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å ~4MB)
FILE_SIZE=$(stat -c%s "$BIN_FILE")
MAX_SIZE=4194304  # 4MB

if [ $FILE_SIZE -gt $MAX_SIZE ]; then
    echo "–û—à–∏–±–∫–∞: —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ($FILE_SIZE –±–∞–π—Ç > $MAX_SIZE –±–∞–π—Ç)"
    exit 1
fi

echo "–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $FILE_SIZE –±–∞–π—Ç"
echo "–ê–¥—Ä–µ—Å –∑–∞–ø–∏—Å–∏ –≤ SPI Flash: $UPDATE_ADDR"

# –ù–∞–π—Ç–∏ PCIe BAR –∞–¥—Ä–µ—Å
PCI_DEVICE=$(lspci -D | grep -i "time\|facebook\|celestica" | head -1 | cut -d' ' -f1)
if [ -z "$PCI_DEVICE" ]; then
    echo "–û—à–∏–±–∫–∞: TimeCard –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

BAR_PATH="/sys/bus/pci/devices/$PCI_DEVICE/resource2"  # –û–±—ã—á–Ω–æ resource2 –¥–ª—è BAR2
if [ ! -e "$BAR_PATH" ]; then
    echo "–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω PCIe BAR –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ $PCI_DEVICE"
    exit 1
fi

echo "–ù–∞–π–¥–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: $PCI_DEVICE"
echo "–í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞–º!"
echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ."
echo ""
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "–û—Ç–º–µ–Ω–µ–Ω–æ"
    exit 0
fi

# –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ AXI Quad SPI
# –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PCIe BAR
# –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞/—É—Ç–∏–ª–∏—Ç—ã

echo "–î–ª—è –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ AXI Quad SPI —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞"
echo "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ ptp_ocp –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ devlink"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ AXI Quad SPI —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å devlink, –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω.

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É flashrom (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å SPI —á–µ—Ä–µ–∑ sysfs –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å flashrom
which flashrom

# –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
# (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É)
sudo flashrom -p linux_spi:dev=/dev/spidevX.X -w TimeCardOS_Production.bin -o 0x400000
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –•–æ–ª–æ–¥–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ **–ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É:

```bash
# –í—ã–∫–ª—é—á–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
sudo shutdown -h now

# –û—Ç–∫–ª—é—á–∏—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ –Ω–∞ 10-15 —Å–µ–∫—É–Ω–¥
# –ó–∞—Ç–µ–º –≤–∫–ª—é—á–∏—Ç–µ —Å–Ω–æ–≤–∞
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–æ—Å—å
lspci | grep -i "time\|facebook\|celestica"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥—Ä–∞–π–≤–µ—Ä–∞
dmesg | grep ptp_ocp

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞:
# ptp_ocp: probe successful
# ptp_ocp: registered PTP clock
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—à–∏–≤–∫–∏

```bash
# –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
cat /sys/class/timecard/ocp0/version 2>/dev/null

# –ò–ª–∏ —á–µ—Ä–µ–∑ debugfs
cat /sys/kernel/debug/ptp_ocp/version 2>/dev/null

# –ò–ª–∏ —á–µ—Ä–µ–∑ —á—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤–µ—Ä—Å–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç root)
# –ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤–µ—Ä—Å–∏–∏: 0x00020000 (–∏–ª–∏ 0x02020000 –¥–ª—è LitePCIe)
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ PPS —É—Å—Ç—Ä–æ–π—Å—Ç–≤
ls /dev/pps*

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ PHC (PTP Hardware Clock)
ls /dev/ptp*

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
ls -la /sys/class/timecard/ocp0/
```

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Golden Image. –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Golden Image –±—ã–ª –∑–∞–ø–∏—Å–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –ø—Ä–æ—à–∏–≤–∫–µ
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è)
3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø–µ—Ä–µ–ø—Ä–æ—à–µ–π—Ç–µ —á–µ—Ä–µ–∑ JTAG —Å `Factory_TimeCardOS_Production.bin`

### –ü—Ä–æ–±–ª–µ–º–∞: devlink –Ω–µ –Ω–∞–π–¥–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –¥—Ä–∞–π–≤–µ—Ä–∞: `modinfo ptp_ocp`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥—Ä–∞–π–≤–µ—Ä —Å–æ–±—Ä–∞–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π devlink
- –û–±–Ω–æ–≤–∏—Ç–µ –¥—Ä–∞–π–≤–µ—Ä –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ devlink

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo ls -la /sys/class/devlink/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
ls -lh /lib/firmware/TimeCardOS_Production.bin

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —è–¥—Ä–∞
dmesg | tail -50
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `TimeCardOS_Production.bin` (Update –æ–±—Ä–∞–∑)
- –†–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ 2-4 MB
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Factory_...bin` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è!

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–ï –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Golden Image** (`0x00000000`) –≤ –ø–æ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
   - Golden Image –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JTAG
   - –û–Ω —Å–ª—É–∂–∏—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

2. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª**
   - –î–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –ø—Ä–æ—à–∏–≤–∫–∏: `Factory_TimeCardOS_Production.bin`
   - –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: `TimeCardOS_Production.bin`

3. **–ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—à–∏–≤–∫–∏**
   - –ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
   - –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é –ø—Ä–æ—à–∏–≤–∫–∏

4. **–í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ö–æ–ª–æ–¥–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É**
   - –ü—Ä–æ—Å—Ç–æ `reboot` –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ 10-15 —Å–µ–∫—É–Ω–¥

### üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ—à–∏–≤–∫–∏

```
Factory_TimeCardOS_Production.bin
‚îú‚îÄ‚îÄ 0x00000000 - 0x002C8B2F: Golden_TimeCardOS_Production.bit
‚îî‚îÄ‚îÄ 0x00400000 - 0x006CA157: TimeCardOS_Production.bit

TimeCardOS_Production.bin (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
‚îî‚îÄ‚îÄ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω –ø–æ –∞–¥—Ä–µ—Å—É 0x00400000
```

### üîß –ê–¥—Ä–µ—Å–∞ –≤ –∞–¥—Ä–µ—Å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ

- **AXI Quad SPI Flash**: `0x0031_0000` (–¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- **AXI HWICAP**: `0x0030_0000` (–¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ICAP)
- **FPGA Version Register**: `0x0002_0000` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–∏)

### üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
dmesg > /tmp/dmesg_before_update.log

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo devlink dev flash pci/0000:02:00.0 file /lib/firmware/TimeCardOS_Production.bin 2>&1 | tee /tmp/flash_update.log

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
dmesg > /tmp/dmesg_after_update.log
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —è–¥—Ä–∞: `dmesg | grep -i "ptp\|timecard\|spi"`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –¥—Ä–∞–π–≤–µ—Ä–∞: `modinfo ptp_ocp`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞: [Open Compute Time-Appliance Project](https://github.com/opencomputeproject/Time-Appliance-Project)

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0  
**–î–∞—Ç–∞**: 2025-01-16  
**–î–ª—è –≤–µ—Ä—Å–∏–∏**: TimeCard_Production
